<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Company Registration</title>
  <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='styles/style.css') }}">
</head>
<body>
  <header>
    <h1>Company Registration</h1>
  </header>

  <div class="container">
    <form id="companyForm">
      <label>Company ID:</label>
      <input type="number" name="company_id" required>

      <label>Name:</label>
      <input type="text" name="name" required>

      <label>Skills (comma separated):</label>
      <input type="text" name="skills">

      <label>Experience (years):</label>
      <input type="number" name="experience">

      <label>Education (comma separated):</label>
      <input type="text" name="education">

      <button type="submit">Register</button>
    </form>

    <h2>Registered Companies</h2>
    <table id="companyTable">
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Skills</th>
          <th>Experience</th>
          <th>Education</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <a href="/" class="back-link">‚Üê Back Home</a>
  </div>

  <script>
    async function loadCompanies() {
      const res = await fetch("/companies");
      const companies = await res.json();
      const tbody = document.querySelector("#companyTable tbody");
      tbody.innerHTML = "";
      companies.forEach(c => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${c.company_id}</td>
          <td>${c.name}</td>
          <td>${c.requirements.skills.join(", ")}</td>
          <td>${c.requirements.experience || "-"}</td>
          <td>${c.requirements.education.join(", ")}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    document.getElementById("companyForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const body = {
        company_id: parseInt(formData.get("company_id")),
        name: formData.get("name"),
        requirements: {
          skills: formData.get("skills").split(",").map(s => s.trim()).filter(Boolean),
          experience: parseInt(formData.get("experience")),
          education: formData.get("education").split(",").map(s => s.trim()).filter(Boolean)
        }
      };
      await fetch("/company", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body)
      });
      e.target.reset();
      loadCompanies();
    });

    loadCompanies();
  </script>
</body>
</html>
